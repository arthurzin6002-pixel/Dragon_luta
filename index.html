<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo</title>

<style>
body{margin:0;overflow:hidden;font-family:Arial;background:black;color:white}
canvas{display:none}
#menu{position:absolute;inset:0;background:#0033cc;display:flex;flex-direction:column;align-items:center;justify-content:center}
.section{display:none}
button{margin:6px;padding:12px 18px;font-size:16px;border:none;border-radius:10px}
.controls{position:absolute;bottom:10px;width:100%;display:none;justify-content:space-between;padding:10px}
#msg{position:absolute;top:40%;width:100%;text-align:center;font-size:28px;display:none}
#specialCount{position:absolute;top:40px;left:20px;font-size:18px}
</style>
</head>

<body>

<!-- SONS -->
<audio id="sndPlayer" src="kame_player.mp3" preload="auto"></audio>
<audio id="sndBoss" src="kame_boss.mp3" preload="auto"></audio>

<div id="menu">
 <h1>MENU</h1>
 <p id="coins"></p>

 <button onclick="openLevels()">üéÆ N√çVEIS</button>
 <button onclick="openShop()">üõí LOJA</button>
 <button onclick="resetConta()">üîÑ RESETAR CONTA</button>

 <div id="levels" class="section"></div>

 <div id="shop" class="section">
  <h2>LOJA</h2>
  <button onclick="buyLife()">‚ù§Ô∏è Vida +40 (Pre√ßo: <span id="pLife"></span>)</button>
  <button onclick="buyDamage()">üëä Dano +5 (Pre√ßo: <span id="pDmg"></span>)</button>
  <button onclick="buySpeed()">‚ö° Vel +1 (Pre√ßo: <span id="pSpd"></span>)</button>
  <button id="btnEspecial" onclick="buyEspecial()">üî• Ataque Especial (50 moedas | n√≠vel 5)</button>
  <button onclick="closeShop()">‚¨Ö Voltar</button>
 </div>
</div>

<div id="msg"></div>
<div id="specialCount"></div>

<canvas id="game"></canvas>

<div class="controls" id="controls">
 <div>
  <button onclick="left()">‚¨Ö</button>
  <button onclick="right()">‚û°</button>
  <button onclick="jump()">‚¨Ü</button>
 </div>
 <div>
  <button onclick="attack()">üëä</button>
  <button id="btnEspecialGame" onclick="especial()" style="display:none">üî•</button>
 </div>
</div>

<script>
/* CANVAS */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

/* SONS */
const sndPlayer=document.getElementById("sndPlayer");
const sndBoss=document.getElementById("sndBoss");

/* FUNDO */
const bg=new Image();
bg.src="arena.jpg";

/* CONFIG */
const gravity=0.8, MAX_LEVEL=15, ROUNDS=3;

/* SAVE */
let moedas=+localStorage.getItem("moedas")||0;
let nivelLiberado=+localStorage.getItem("nivel")||1;

/* ESPECIAL */
let especialComprado=localStorage.getItem("especial")==="true";
const precoEspecial=50;
let cooldownEspecial=0;
let usosEspecial=3;
let efeitoEspecial=null;
let efeitoBoss=null;

/* CONTROLE DE TRAVA */
let playerTravado=false;

/* PRE√áOS */
let pLife=+localStorage.getItem("pLife")||3;
let pDmg=+localStorage.getItem("pDmg")||5;
let pSpd=+localStorage.getItem("pSpd")||3;

/* PLAYER */
let player={x:200,y:canvas.height-200,vy:0,lifeMax:+localStorage.getItem("lifeMax")||200,life:200,damage:+localStorage.getItem("damage")||25,speed:+localStorage.getItem("speed")||5};

let enemy={},faseAtual=1,roundAtual=1,running=false;

/* MENU / SHOP */
function hideSections(){document.querySelectorAll(".section").forEach(s=>s.style.display="none");}
function openLevels(){hideSections();levels.innerHTML="";for(let i=1;i<=MAX_LEVEL;i++){const b=document.createElement("button");b.textContent="N√≠vel "+i;b.disabled=i>nivelLiberado;b.onclick=()=>startLevel(i);levels.appendChild(b);}levels.style.display="block";}
function openShop(){hideSections();shop.style.display="block";updateShop();}
function closeShop(){shop.style.display="none"}
function updateShop(){
 coins.innerText="Moedas: "+moedas;
 pLifeEl.innerText=pLife;pDmgEl.innerText=pDmg;pSpdEl.innerText=pSpd;
 btnEspecial.style.display=especialComprado?"none":"block";
 btnEspecialGame.style.display=especialComprado?"inline-block":"none";
}
const pLifeEl=document.getElementById("pLife"),pDmgEl=document.getElementById("pDmg"),pSpdEl=document.getElementById("pSpd");
const btnEspecial=document.getElementById("btnEspecial"),btnEspecialGame=document.getElementById("btnEspecialGame");

/* LOJA */
function buyLife(){if(moedas>=pLife){moedas-=pLife;player.lifeMax+=40;pLife+=3;save();}}
function buyDamage(){if(moedas>=pDmg){moedas-=pDmg;player.damage+=5;pDmg+=5;save();}}
function buySpeed(){if(moedas>=pSpd){moedas-=pSpd;player.speed+=1;pSpd+=3;save();}}
function buyEspecial(){if(nivelLiberado<5)return;if(moedas>=precoEspecial){moedas-=precoEspecial;especialComprado=true;localStorage.setItem("especial","true");save();}}
function save(){localStorage.setItem("moedas",moedas);localStorage.setItem("lifeMax",player.lifeMax);localStorage.setItem("damage",player.damage);localStorage.setItem("speed",player.speed);localStorage.setItem("pLife",pLife);localStorage.setItem("pDmg",pDmg);localStorage.setItem("pSpd",pSpd);localStorage.setItem("nivel",nivelLiberado);updateShop();}
function resetConta(){if(confirm("Resetar tudo?")){localStorage.clear();location.reload();}}

/* JOGO */
function startLevel(lv){faseAtual=lv;roundAtual=1;startRound();}
function startRound(){
 menu.style.display="none";game.style.display="block";controls.style.display="flex";
 usosEspecial=3;
 playerTravado=false;
 document.getElementById("specialCount").innerText="üî• "+usosEspecial+"/3";
 player.life=player.lifeMax;
 enemy={x:650,y:canvas.height-200,life:150+faseAtual*60,lifeMax:150+faseAtual*60,speed:1+faseAtual*0.2,damage:1+faseAtual*0.4};
 running=true;loop();
}

/* CONTROLES (BLOQUEADOS QUANDO TRAVADO) */
function left(){if(playerTravado)return;player.x-=player.speed}
function right(){if(playerTravado)return;player.x+=player.speed}
function jump(){if(playerTravado)return;if(player.vy===0)player.vy=-15}
function attack(){if(playerTravado)return;if(Math.abs(player.x-enemy.x)<90)enemy.life-=player.damage}

/* KAMEKAMERA JOGADOR */
function especial(){
 if(playerTravado)return;
 if(!especialComprado||cooldownEspecial>0||usosEspecial<=0)return;
 enemy.life-=player.damage*3;
 usosEspecial--;
 document.getElementById("specialCount").innerText="üî• "+usosEspecial+"/3";
 sndPlayer.currentTime=0; sndPlayer.play();
 efeitoEspecial={x:player.x,y:player.y-40,dir:enemy.x>player.x?1:-1,t:20};
 cooldownEspecial=180;
}

/* LOOP */
function loop(){
 if(!running)return;
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.drawImage(bg,0,0,canvas.width,canvas.height);

 if(!playerTravado){
  player.vy+=gravity;
  player.y+=player.vy;
 }
 if(player.y>canvas.height-200){player.y=canvas.height-200;player.vy=0;}

 if(enemy.x>player.x)enemy.x-=enemy.speed;
 if(enemy.x<player.x)enemy.x+=enemy.speed;

 if(Math.abs(enemy.x-player.x)<55 && !playerTravado){
  player.life-=enemy.damage;
 }

 /* KAMEKAMERA DO CHEFE */
 if(faseAtual>=7 && cooldownEspecial<=0){
  playerTravado=true;
  player.life-=enemy.damage*2;
  sndBoss.currentTime=0; sndBoss.play();
  efeitoBoss={x:enemy.x,y:enemy.y-40,dir:enemy.x>player.x?-1:1,t:25};
  cooldownEspecial=240;
 }

 /* EFEITOS */
 function beam(e,c,unlock){
  ctx.strokeStyle=c;ctx.lineWidth=8;
  ctx.beginPath();ctx.moveTo(e.x,e.y);ctx.lineTo(e.x+e.dir*300,e.y);ctx.stroke();
  e.t--;
  if(e.t<=0){
   if(unlock) playerTravado=false;
   return null;
  }
  return e;
 }
 if(efeitoEspecial)efeitoEspecial=beam(efeitoEspecial,"cyan",false);
 if(efeitoBoss)efeitoBoss=beam(efeitoBoss,"red",true);

 if(cooldownEspecial>0)cooldownEspecial--;

 draw(player.x,player.y,"cyan");draw(enemy.x,enemy.y,"red");drawLife();

 if(player.life<=0){showMsg("Voc√™ perdeu!");setTimeout(backMenu,1200);running=false;return;}
 if(enemy.life<=0){
  running=false;
  if(roundAtual<ROUNDS){roundAtual++;setTimeout(startRound,1000);}
  else{moedas+=faseAtual*6;if(faseAtual===nivelLiberado&&nivelLiberado<MAX_LEVEL)nivelLiberado++;save();setTimeout(backMenu,1500);}
 }
 requestAnimationFrame(loop);
}

/* DESENHO */
function draw(x,y,c){
 ctx.strokeStyle=c;ctx.lineWidth=4;
 ctx.beginPath();ctx.arc(x,y-50,15,0,Math.PI*2);ctx.stroke();
 ctx.beginPath();ctx.moveTo(x,y-35);ctx.lineTo(x,y+20);ctx.stroke();
 ctx.beginPath();ctx.moveTo(x,y-20);ctx.lineTo(x-20,y);ctx.stroke();
 ctx.beginPath();ctx.moveTo(x,y-20);ctx.lineTo(x+20,y);ctx.stroke();
 ctx.beginPath();ctx.moveTo(x,y+20);ctx.lineTo(x-15,y+55);ctx.stroke();
 ctx.beginPath();ctx.moveTo(x,y+20);ctx.lineTo(x+15,y+55);ctx.stroke();
}
function drawLife(){
 ctx.fillStyle="lime";ctx.fillRect(20,20,(player.life/player.lifeMax)*200,14);
 ctx.fillStyle="red";ctx.fillRect(canvas.width-220,20,(enemy.life/enemy.lifeMax)*200,14);
}
function showMsg(t){msg.innerText=t;msg.style.display="block";setTimeout(()=>msg.style.display="none",900);}
function backMenu(){running=false;game.style.display="none";controls.style.display="none";menu.style.display="flex";hideSections();updateShop();}
</script>

</body>
</html>